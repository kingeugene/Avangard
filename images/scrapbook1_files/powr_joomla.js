!function(){function e(){if("http://localhost:3000"!=c&&"https://localhost:3000"!=c&&"http://10.0.2.2:3000"!=c&&"http://localhost:8888"!=c&&"samoanhighlandretreat.com"!=location.host)return!1;for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function t(t,r,a,o,n,i){var d=t;e("Match:",t);var s=d.match(/powr-[^\s\]]*/i),l=d.match(/label="[^"]*"/i);null==l&&(l=d.match(/label='[^']*'/i)),null==l&&(l="");var c='<div class="'+s+'" '+l+"></div>";return e("Result is:"+c),c}function r(e){var t={},r=e.search("\\?");e=e.substr(r+1);for(var a=e.split("&"),o=0;o<a.length;o++){var n=a[o].split("=");if("undefined"==typeof t[n[0]])t[n[0]]=n[1];else if("string"==typeof t[n[0]]){var i=[t[n[0]],n[1]];t[n[0]]=i}else t[n[0]].push(n[1])}return t}function a(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):!1}function o(e){for(var t=!1,r=e;r&&r!==document;r=r.parentNode)if(void 0!=r.classList&&r.classList.contains("powr-ignore")){t=!0;break}return t}function n(){try{return window.top.location.href}catch(t){return e("Couldn't get page url:",t),""}}function i(t,r,a){function o(){var o={message:"loaded",data:{iframe_index:r}};e("POWr.js sending load message to url"+a+"; iframe:",t),rr=o,t.contentWindow.postMessage(JSON.stringify(o),a)}t.addEventListener?t.addEventListener("load",o):t.attachEvent("onload",o)}function d(t,r){var a=new XMLHttpRequest;a.open("GET",r,!0),a.withCredentials=!0,a.onreadystatechange=function(){if(e("Async ready state change!",a),a.readyState==XMLHttpRequest.DONE||4==a.readyState)if(200==a.status){e("POWr App Data:",a.responseText);var r=JSON.parse(a.responseText);r.iframe_index=t,POWR_RECEIVERS[t].data=r;var o=setInterval(function(){POWR_RECEIVERS[t].loaded&&(POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"loadView",data:r}),POWR_RECEIVERS[t].url),clearInterval(o))},10)}else e("Error receiving POWr App Data")},a.send()}function s(t){e("Settings got a message!",t);try{var r=JSON.parse(t.data);if("viewLoaded"==r.message){e("Settings received view loaded");var a=r.data.iframe_index;POWR_RECEIVERS[a].loaded=!0}else if("updateSize"==r.message)if("undefined"!=typeof gadgets&&"undefined"!=typeof gadgets.window&&"undefined"!=typeof gadgets.window.adjustHeight)gadgets.window.adjustHeight(r.data.height);else{var a=r.data.iframe_index,o=document.querySelectorAll('[powrindex="'+a+'"]')[0];o.height=r.data.height+"px",o.style.height=r.data.height+"px",e("Updating size of el",o)}else if("loadMe"==r.message){e("Settings received loadMe request");var a=r.data.iframe_index;void 0!=POWR_RECEIVERS[a]&&void 0!=POWR_RECEIVERS[a].data&&POWR_RECEIVERS[a].receiver.postMessage(JSON.stringify({message:"loadView",data:POWR_RECEIVERS[a].data}),POWR_RECEIVERS[a].url)}}catch(n){e("Error with message",n)}}function l(t){if(e("Keydown is: ",t),80==t.keyCode&&(g=!0,setTimeout(function(){g=!1},2e3)),38==t.keyCode&&g){for(var r=0;r<POWR_RECEIVERS.length;r++)POWR_RECEIVERS[r].receiver.postMessage(JSON.stringify({message:"showEdit"}),POWR_RECEIVERS[r].url);return t.preventDefault(),!1}if(40==t.keyCode&&g){for(var r=0;r<POWR_RECEIVERS.length;r++)POWR_RECEIVERS[r].receiver.postMessage(JSON.stringify({message:"hideEdit"}),POWR_RECEIVERS[r].url);return t.preventDefault(),!1}}var c="https://www.powr.io",u="https://www.powr.io";if("undefined"!=typeof loadPowr)return void e("Powr already loaded");window.addEventListener?window.addEventListener("message",s):window.attachEvent("onmessage",s);var p=0;POWR_RECEIVERS=[],loadPowr=function(){for(var s=null,l=null,v=null,g=!1,f=document.querySelectorAll("script"),w=0;w<f.length;w++){var h=f[w],m=h.getAttribute("src");if(void 0!=m){var E=h.getAttribute("powr-token"),R=h.getAttribute("external-type"),y=h.getAttribute("powr-load");if(void 0==y&&(y="async"),a()&&a()<=9&&(y="sync"),g=h.getAttribute("demo-mode"),void 0!=E?s=E:m.search("powr-token")>-1&&(v=r(m),e("powr token present in query, query obj: ",v),void 0!==v["powr-token"]&&v["powr-token"].length>0&&(s=v["powr-token"])),void 0!=s){void 0!=R?l=R:m.search("external-type")>-1&&(v=r(m),void 0!=v["external-type"]&&v["external-type"].length>0&&(l=v["external-type"]));break}}}(null==s||0==s.length)&&(s=window.top.location.host);var S=!0;if(S){for(var C=/\[powr-[^\]]*\]/gi,b=/\[powr-[^\s\]]*/gi,_=document.querySelectorAll("a"),w=0;w<_.length;w++){var O=_[w];if(!o(O)){var P=O.previousSibling,I=O.nextSibling;if(P&&I&&O.getAttribute("href")&&O.getAttribute("href").search("tel")>-1&&3==P.nodeType&&3==I.nodeType&&P.nodeValue.match(b)&&I.nodeValue.search("]")>-1){var A=O.innerHTML,L=P.nodeValue.match(/powr-[^\s\]]*/gi)[0],V=document.createElement("div");V.innerHTML='<div class="'+L+'" label="'+A+'"></div>',P.parentNode.removeChild(P),I.parentNode.removeChild(I),O.parentNode.replaceChild(V,O)}}}for(var _=document.querySelectorAll("body, body *"),w=0;w<_.length;w++){var O=_[w],W=O.childNodes;if(!o(O))for(var x=0;x<W.length;x++){var N=W[x];if(3==N.nodeType){var k=N.nodeValue,M=k.replace(C,t);if(M!=k){var V=document.createElement("div");V.innerHTML=M,O.replaceChild(V,N)}}}}}if(0==document.querySelectorAll("#powrIframeLoader").length){var T=document.createElement("div"),q=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];T.id="powrIframeLoader",T.innerHTML="&shy;<style> .powrLoaded iframe { visibility: hidden; } </style>",q.parentNode.insertBefore(T,q)}for(var H=document.querySelectorAll("[class*=powr-]"),w=0;w<H.length;w++){var J=H[w];if(!(o(J)||J.className.search("powrLoaded")>-1)){J.className+=" powrLoaded";for(var j=J.className.split(/\s+/),w=0;w<j.length;w++)if(0===j[w].toLowerCase().search("powr-")){var D=j[w].toLowerCase().replace("powr-","");break}if("undefined"==typeof D)return;var U=J.getAttribute("label");void 0==U&&(U="");var B="true"==g||"true"==J.getAttribute("demo-mode")?!0:!1,z=c+"/plugins/"+D+"/cached_view?load="+y+"&index="+p+"&powr_token="+s+"&user_label="+encodeURIComponent(U)+"&demo_mode="+B,X=u+"/plugins/"+D+"/view.json?powr_token="+s+"&user_label="+encodeURIComponent(U)+"&demo_mode="+B;void 0!=l&&(X+="&external_type="+l),e("page url IS "+n()),n()&&(X+="&url="+encodeURIComponent(n())),X+="&request_url="+encodeURIComponent(document.location.protocol+"//"+document.location.host);var G=document.createElement("iframe");G.src=z,G.setAttribute("powrindex",p),G.width="100%",G.height="100%",G.frameBorder="0",G.style.visibility="visible",G.setAttribute("webkitallowfullscreen",""),G.setAttribute("mozallowfullscreen",""),G.setAttribute("allowfullscreen","");try{/iPhone|iPod|iPad/.test(navigator.userAgent)&&(G.style.minWidth="100%",G.style.width="1px",G.setAttribute("scrolling","no"))}catch(K){console.log("Err: "+K)}i(G,p,z),J.appendChild(G);var F=G.contentWindow;POWR_RECEIVERS.push({receiver:F,url:z}),"async"==y&&d(p,X),p++}}};for(var v=0;10>v;v++)setTimeout(function(){loadPowr()},2e3*v);window.addEventListener?window.addEventListener("load",loadPowr):window.attachEvent("onload",loadPowr);var g=!1;window.addEventListener?window.addEventListener("keydown",l):window.attachEvent("onkeydown",l)}();